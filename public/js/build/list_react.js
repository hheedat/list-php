webpackJsonp([1],{0:function(e,t,n){"use strict";var r=n(20),o=n(25),a=n(1),i=n(169),s=n(173),u=n(170);dispacher.list=new i;var l=r.createClass({displayName:"ListShow",timer:null,getInitialState:function(){return{data:[]}},loadDataFromServer:function(){return dispacher.list.trigger("show-loading"),o.ajax({url:this.props.url,dataType:"json",method:"post"}).done(function(e){"succ"==e.type?this.updateList(e):alert("服务端出现了一些错误"+e.msg)}.bind(this)).fail(function(e,t,n){alert("出现了一些问题"),console.error(this.props.url,t,n.toString())}.bind(this)).always(function(){dispacher.list.trigger("hide-loading")})},updateList:function(e){return e?void this.setState({data:e.msg}):!1},componentDidMount:function(){dispacher.list.on("update-list",this.loadDataFromServer),this.loadDataFromServer().then(function(){dispacher.list.trigger("update-input-width")}),this.timer=setInterval(this.loadDataFromServer,this.props.pollInterval)},componentWillUnmount:function(){dispacher.list.off("update-list",this.loadDataFromServer),clearInterval(this.timer)},render:function(){return r.createElement("div",{className:"list-wrapper"},r.createElement("div",{className:"list-head"},r.createElement("span",null)),r.createElement(d,{data:this.state.data,urlItemComplete:"/home/list/itemComplete",urlItemUndo:"/home/list/itemUndo"}))}}),d=r.createClass({displayName:"ListCon",changeItemStatus:function(e){e.stopPropagation();var t=e.target.checked?this.props.urlItemComplete:this.props.urlItemUndo;return dispacher.list.trigger("show-loading"),o.ajax({url:t,dataType:"json",method:"post",data:{id:e.target.getAttribute("data-id")}}).done(function(e){"succ"==e.type?dispacher.list.trigger("update-list"):alert("服务端出现了一些错误"+e.msg)}).fail(function(e,t,n){alert("出现了一些问题"),console.error(this.props.url,t,n.toString())}.bind(this)).always(function(){dispacher.list.trigger("hide-loading")})},checkItemDetail:function(e){dispacher.list.trigger("show-list-detail",e)},render:function(){var e=this,t=this.props.data.map(function(t){return r.createElement("div",{className:"list-item cf",key:t.id,onClick:e.checkItemDetail.bind(e,t.id)},r.createElement("input",{type:"checkbox","data-id":t.id,onClick:e.changeItemStatus,defaultChecked:t.status?!1:!0}),r.createElement("span",{className:"list-title"},t.title),r.createElement("span",{className:"list-time"},a().date()!=a(t.time).date()?a().format("l"):a(t.time).startOf("second").fromNow()))});return r.createElement("div",{className:"list-data"},t)}}),c=r.createClass({displayName:"ListAdd",getInitialState:function(){return dispacher.list.on("update-input-width",this.setInputWidth),{inputWidth:null}},componentDidMount:function(){this.setInputWidth(),window.addEventListener("resize",this.handleResize)},setInputWidth:function(){var e=this.refs.title.getDOMNode(),t=this.refs.addBtn.getDOMNode();this.setState({inputWidth:parseInt(getComputedStyle(e.parentNode).width)-parseInt(t.offsetWidth)-35+"px"})},addList:function(e){var t=this.refs.title.getDOMNode().value.trim();t&&(this.submitList({title:t}),this.refs.title.getDOMNode().value="")},handleResize:function(){this.setInputWidth()},handleKeyDown:function(e){13===e.keyCode&&this.addList()},submitList:function(e){return dispacher.list.trigger("show-loading"),o.ajax({url:this.props.url,dataType:"json",type:"post",data:e}).done(function(e){"succ"==e.type?dispacher.list.trigger("update-list"):alert("服务端出现了一些错误"+e.msg)}.bind(this)).fail(function(e,t,n){console.error(this.props.url,t,n),alert("出现了一些问题")}.bind(this)).always(function(){dispacher.list.trigger("hide-loading")})},componentWillUnmount:function(){window.removeEventListener("resize",this.handleResize)},render:function(){return r.createElement("div",{className:"list-add cf"},r.createElement("input",{type:"text",className:"input-text",ref:"title",style:{width:this.state.inputWidth},onKeyDown:this.handleKeyDown,placeholder:"add new list ..."}),r.createElement("button",{ref:"addBtn",className:"add",onClick:this.addList},"add"))}}),p=r.createClass({displayName:"ListDetail",dataID:null,getInitialState:function(){return dispacher.list.on("show-list-detail",this.loadDataFromServer),{data:null}},componentDidMount:function(){},loadDataFromServer:function(e,t){return this.dataID=t,dispacher.list.trigger("show-loading"),o.ajax({url:this.props.urlCheck,dataType:"json",type:"POST",data:{id:t}}).done(function(e){"succ"==e.type?(this.updateList(e),setTimeout(function(){o(this.refs.mask.getDOMNode()).addClass("list-detail-mask-show"),o(this.refs.wrapper.getDOMNode()).addClass("list-detail-wrapper-show")}.bind(this))):alert("服务端出现了一些错误"+e.msg)}.bind(this)).fail(function(e,t,n){console.error(this.props.url,t,n),alert("出现了一些问题")}.bind(this)).always(function(){dispacher.list.trigger("hide-loading")})},updateList:function(e){return e?void this.setState({data:e.msg}):!1},updateData:function(){var e=this,t=this.refs.title.getDOMNode().value.trim(),n=this.refs.content.getDOMNode().value.trim();if(!t)return void alert("title can not be null");dispacher.list.trigger("show-loading");var r=o.ajax({url:this.props.urlUpdate,dataType:"json",method:"post",data:{id:this.dataID,title:t,content:n}});r.done(function(t){"succ"==t.type?(e.closeDetail(),dispacher.list.trigger("update-list")):alert("服务端出现了一些错误"+t.msg)}).fail(function(e,t,n){console.error(this.props.url,t,n),alert("出现了一些问题")}.bind(this)).always(function(){dispacher.list.trigger("hide-loading")})},deleteData:function(e){e.preventDefault();var t=this;return dispacher.list.trigger("show-loading"),o.ajax({url:this.props.urlDelete,dataType:"json",method:"post",data:{id:this.dataID}}).done(function(e){"succ"==e.type?(t.closeDetail(),dispacher.list.trigger("update-list")):alert("服务端出现了一些错误"+e.msg)}).fail(function(e,t,n){console.error(this.props.url,t,n),alert("出现了一些问题")}.bind(this)).always(function(){dispacher.list.trigger("hide-loading")})},closeDetail:function(e){(!e||e.target.className.match(/list-detail-mask/)||"close-btn"==e.target.className)&&(o(this.refs.wrapper.getDOMNode()).removeClass("list-detail-wrapper-show"),o(this.refs.wrapper.getDOMNode()).removeClass("list-detail-wrapper-show"),setTimeout(function(){this.setState({data:null})}.bind(this),200))},render:function(){var e=null;return this.state.data&&(e=r.createElement("div",{className:"list-detail-mask",ref:"mask",onClick:this.closeDetail},r.createElement("div",{className:"list-detail-wrapper",ref:"wrapper"},r.createElement("div",{className:"list-detail"},r.createElement("div",{className:"list-control cf"},r.createElement("button",{className:"update-btn",onClick:this.updateData},"update"),r.createElement("button",{className:"close-btn",onClick:this.closeDetail},"close")),r.createElement("div",{className:"list-detail-data"},r.createElement("textarea",{className:"my-textarea",ref:"title",defaultValue:this.state.data.title}),r.createElement("input",{type:"text",className:"input-text",ref:"time",disabled:"disabled",value:a(this.state.data.time).format("YYYY-MM-DD HH:mm:ss")}),r.createElement("div",{className:"content"},r.createElement("textarea",{className:"my-textarea",ref:"content",defaultValue:this.state.data.content}))),r.createElement("a",{className:"del-btn",onClick:this.deleteData},"delete"))))),r.createElement("div",null,e)}}),m=r.createClass({displayName:"ListShowComplete",isShow:!1,toggleShow:function(){this.isShow?(this.isShow=!1,this.forceUpdate()):(this.isShow=!0,this.forceUpdate())},render:function(){var e=this.isShow?r.createElement("div",{id:"list-complete-show"},r.createElement(l,{url:"/home/list/checkComplete",pollInterval:6e4})):null;return r.createElement("div",{id:"list-complete"},r.createElement("div",{className:"show-complete"},r.createElement("a",{className:"show-complete-toggle",onClick:this.toggleShow,href:"javascript:void(0);"},this.isShow?"HIDE COMPLETED ITEMS":"SHOW COMPLETED ITEMS")),e)}}),f=r.createClass({displayName:"List",render:function(){return r.createElement("div",{className:"list"},r.createElement(u,null),r.createElement(c,{url:"/home/list/add"}),r.createElement(l,{url:"/home/list/check",pollInterval:6e4}),r.createElement(p,{urlCheck:"/home/list/checkDetail",urlUpdate:"/home/list/update",urlDelete:"/home/list/delete"}),r.createElement(m,null))}});r.initializeTouchEvents(!0),r.render(r.createElement(f,null),document.getElementById("list-con")),r.render(r.createElement(s,{updateInterval:6e4}),document.getElementById("last-update"))},169:function(e,t,n){"use strict";var r=n(25);window.Dispatcher=function(){r.extend(this,r({}))},window.dispacher={};e.exports=Dispatcher},170:function(e,t,n){"use strict";var r=n(20),o=r.createClass({displayName:"LoadingBar",getInitialState:function(){return{className:"loading"}},componentDidMount:function(){dispacher.list.on("show-loading",this.show),dispacher.list.on("hide-loading",this.hide)},show:function(){this.setState({className:"loading is-loading"})},hide:function(){this.setState({className:"loading is-loading loading-complete"}),dispacher.list.trigger("last-update-time")},render:function(){return r.createElement("div",{className:"loading-bar"},r.createElement("div",{ref:"loadingBar",className:this.state.className}))}});e.exports=o},173:function(e,t,n){"use strict";var r=n(20),o=n(1),a=r.createClass({displayName:"LastUpdateTime",timer:null,lastUpdateTime:null,getInitialState:function(){return dispacher.list.on("last-update-time",this.newTime),this.lastUpdateTime=o(),{time:null}},newTime:function(){this.lastUpdateTime=o(),this.updateTime()},updateTime:function(){this.setState({time:o(this.lastUpdateTime).format("MM-DD HH:mm:ss")})},componentDidMount:function(){this.timer=setInterval(function(){this.updateTime()}.bind(this),this.props.updateInterval)},componentWillUnmount:function(){clearInterval(this.timer)},render:function(){return r.createElement("span",null,this.state.time?"LAST SYNC："+this.state.time:"")}});e.exports=a}});